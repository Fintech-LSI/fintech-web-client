# server {
#     listen 80;
#     server_name localhost;
#     root /usr/share/nginx/html;
#     index index.html;
#
#     # Enhanced gzip settings
#     gzip on;
#     gzip_comp_level 6;         # Compression level (1-9, 6 is a good balance)
#     gzip_min_length 1000;      # Good minimum length
#     gzip_types
#         text/plain
#         text/css
#         application/json
#         application/javascript
#         application/x-javascript
#         text/xml
#         application/xml
#         application/xml+rss
#         text/javascript
#         image/svg+xml         # Added SVG compression
#         font/woff2           # Added font compression
#         application/vnd.ms-fontobject
#         application/x-font-ttf
#         application/x-font-opentype;
#     gzip_proxied expired no-cache no-store private auth;
#     gzip_vary on;            # Adds "Vary: Accept-Encoding" header
#
#     # Angular routes handling
#     location / {
#         try_files $uri $uri/ /index.html;
#
#         # Enhanced cache control headers
#         add_header Cache-Control "no-cache, no-store, must-revalidate";
#         add_header Pragma "no-cache";
#         add_header Expires "0";
#     }
#
#     # Improved static asset caching
#     location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
#         expires 1y;
#         add_header Cache-Control "public, no-transform, max-age=31536000";
#         access_log off;        # Disable access logging for static files
#         tcp_nodelay off;       # Enable TCP nodelay for better performance
#         tcp_nopush on;         # Enable TCP nopush for better performance
#         sendfile on;           # Enable sendfile for better performance
#     }
#
#     # Enhanced security headers
#     add_header X-Frame-Options "SAMEORIGIN";
#     add_header X-XSS-Protection "1; mode=block";
#     add_header X-Content-Type-Options "nosniff";
#     add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";
#     add_header Referrer-Policy "strict-origin-when-cross-origin";
#     add_header Permissions-Policy "camera=(), microphone=(), geolocation=()";
#
#     # Improved health check endpoint
#     location /health {
#         access_log off;
#         add_header Content-Type text/plain;
#         return 200 'healthy\n';
#     }
#
#     # Better error handling
#     error_page 404 /index.html;
#     error_page 500 502 503 504 /50x.html;
#     location = /50x.html {
#         root /usr/share/nginx/html;
#         internal;              # Only allow internal redirects
#     }
#
#     # Deny access to hidden files
#     location ~ /\. {
#         deny all;
#         access_log off;
#         log_not_found off;
#     }
# }
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Enable gzip compression
    gzip on;
    gzip_comp_level 6;         # Compression level (1-9, 6 is a good balance)
    gzip_min_length 1000;      # Minimum file size to compress
    gzip_types
        text/plain
        text/css
        application/json
        application/javascript
        application/x-javascript
        text/xml
        application/xml
        application/xml+rss
        text/javascript
        image/svg+xml         # Compress SVG files
        font/woff2           # Compress WOFF2 fonts
        application/vnd.ms-fontobject
        application/x-font-ttf
        application/x-font-opentype;
    gzip_proxied expired no-cache no-store private auth;
    gzip_vary on;            # Add "Vary: Accept-Encoding" header

    # Angular routes handling
    location / {
        try_files $uri $uri/ /index.html;

        # Disable caching for HTML files
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
    }

    # Cache static assets (JS, CSS, images, fonts, etc.)
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;  # Cache for 1 year
        add_header Cache-Control "public, no-transform, max-age=31536000";
        access_log off;  # Disable access logging for static files
    }

    # Enhanced security headers
    add_header X-Frame-Options "SAMEORIGIN";  # Prevent clickjacking
    add_header X-XSS-Protection "1; mode=block";  # Enable XSS protection
    add_header X-Content-Type-Options "nosniff";  # Prevent MIME type sniffing
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";  # Enforce HTTPS
    add_header Referrer-Policy "strict-origin-when-cross-origin";  # Control referrer information
    add_header Permissions-Policy "camera=(), microphone=(), geolocation=()";  # Disable unwanted features

    # Health check endpoint
    location /health {
        access_log off;  # Disable logging for health checks
        add_header Content-Type text/plain;
        return 200 'healthy\n';
    }

    # Error handling
    error_page 404 /index.html;  # Serve index.html for 404 errors
    error_page 500 502 503 504 /50x.html;  # Custom error page for server errors
    location = /50x.html {
        root /usr/share/nginx/html;
        internal;  # Only allow internal redirects
    }

    # Deny access to hidden files (e.g., .htaccess, .git, etc.)
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
}
